---
title: "[BIGDATA] 2-4 데이터 마트의 기본 구조"

categories: 
  - BIGDATA
tags:
  - [bigdata, 공부]

toc: true
toc_sticky: true
---

# 빅데이터의 탐색

## 데이터 마트의 기본 구조

BI 도구에서 대화형으로 데이터를 참고하려고 하면, 시각화에 필요한 정보만을 모은 데이터 마트가 필수적이다.


### 시각화에 적합한 데이터 마트 만들기 - OLAP

BI 도구에 있어서 핵심적인 개념 중 하나로 'OLAP(online analytical processing)'라는 구조가 있다. <br> 데이터 디스커버리를 위한 BI 도구는 OLAP의 개념을 몰라도 사용할 수 있도록 고안되어 있기 때문에 그 존재를 의식할 일은 거의 없지만, 데이터 마트를 구축할 때는 다소 사전 지식이 필요하다.


**다차원 모델과 OLAP 큐브**

OLAP는 데이터 집계를 효율화하는 접근 방법 중의 하나다. <BR> OLAP는 '다차원 모델'의 데이터 구조를 'MDX(multidimensional expressions)' 등의 쿼리 언어로 집계한다. <br> 데이터 분석을 위해 만들어진 다차원 데이터를 'OLAP 큐브(OLAP cube)'라고 부르며, 그것을 크로스 집계하는 구조가 OLAP다.


BI 도구는 본래 OLAP의 구조를 사용하여 데이터를 집계하기 위한 소프트웨어다. <BR> 따라서, 데이터 마트도 이전에는 OLAP 큐브로 작성되어 있었다.


**MPP 데이터베이스와 비정규화 테이블**

최근에는 OLAP 큐브를 위해 특별한 구조를 준비하는 것이 아니라, BI 도구와 MPP 데이터베이스를 조합하여 크로스 집계하는 경우가 증가하고 있다.

BI 도구로 생각한 대로의 그래프를 만들기 위해서 만들고 싶은 그래프에 맞추어 '다차원 모델'을 설계한다. <BR> 그러나 MPP 데이터베이스에 다차원 모델의 개념은 없기 때문에 이를 대신해 '비정규화 테이블'을 준비한다. <BR> 그렇게 만든 비정규화 테이블을 BI 도구에서 열어서 기존의 OLAP와 동등한 시각화를 실현할 수 있다.

'시각화에 적합한 데이터 마트를 만드는 것'은, 이렇게 'BI 도구를 위한 비정규화 테이블을 만드는' 프로세스다.


### 테이블을 비정규화하기

데이터베이스의 설계에서는 종종 테이블을 '마스터'와 '트랜잭션'으로 구분한다. <BR> 시간과 함께 생성되는 데이터를 기록한 것이 '트랜잭션(transaction)'이며, 트랜잭션에서 참고되는 각종 정보가 '마스터(master)'다. <br> 트랜잭션은 한 번 기록하면 변화하지 않지만, 마스터는 상황에 따라 다시 쓰인다.

트랜잭션과 마스터로 이루어진 테이블 관계은 RDB에서는 일반적인 '관계형 모델(relational model)'이다. <br> 데이터 분석의 경우에는 정규화된 관계형 모델에서 출발해서 그와는 반대의 작업을 실행한다.


**팩트 테이블과 디멘전 테이블**

데이터 웨어하우스의 세계에서는 트랜잭션처럼 사실이 기록된 것을 '팩트 테이블(fact table)'이라고 하고, 거기에서 참고되는 마스터 데이터 등을 '디멘전 테이블(dimension table)'이라고 한다.


**스타 스키마와 비정규화** (팩트 테이블을 중심으로 여러 디멘전 테이블을 결합)

데이터 마트를 만들 때는 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합하는 것이 좋다. <br> 그림으로 그리면 별 모양이 되므로, 이를 '스타 스키마(star schema)'라고 부른다.

디멘전 테이블을 작성하려면 정규화에 의해 분해된 테이블을 최대한 결합하여 하나의 테이블로 정리한다. <br> 그 결과로 데이터가 중복되어도 괜찮다. <br> 정규화와는 반대의 작업을 하므로 이를 '비정규화(demormalization)'라고 한다.

데이터 마트에서 스타 스키마가 사용되는 데는 두 가지 이유가 있다. <br> 하는 단순하기 때문에 이해하기 쉽고, 데이터 분석을 쉽게 할 수 있다는 점이다. <br> 쿼리 작성법이 정해져 있으므로 SQL을 자동 생성하기 쉬워 BI 도구는 스타 스키마의 테이블에 효율적으로 쿼리를 실행할 수 있도록 디자인되어 있다. <br> 다음은 스타 스키마의 테이블을 SQL로 결합하는 쿼리다.

```sql
SELECT ...
FROM 판매 이력
LEFT JOIN 상품 ON 상품.상품 ID = 판매 이력.상품 ID
LEFT JOIN 점포 ON 점포.점포 ID = 판매 이력.점포 ID
;
```
또 하나는 성능상의 이유다. <BR> 데이터양이 증가함에 따라 팩트 테이블은 디멘전 테이블보다도 훨씬 커져 그 데이터양이 집계 시간을 좌우한다. <BR> 팩트 테이블이 메모리 용량을 초과한 시점에서 디스크 I/O가 발생하고 그 대기 시간이 쿼리의 지연으로 이어진다. <BR> 따라서, 팩트 테이블을 될 수 있는 한 작게 하는 것이 고속화에 있어서 중요하며, 팩트 테이블에는 ID와 같은 키만을 남겨두고 그 외의 나머지는 디멘전 테이블로 옮긴다.


**비정규화 테이블**



### 다차원 모델 시각화에 대비하여 테이블을 추상화하기


**모델의 정의 확장**